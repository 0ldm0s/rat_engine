# HAProxy 配置 - HTTP 模式 + PROXY protocol v2 测试
#
# 客户端 → HAProxy:8081 (PPv2) → 后端:8080 (纯 HTTP)
#
# 验证：
# 1. PROXY protocol v2 能否正确传递客户端 IP
# 2. 纯 HTTP 模式下的路由是否正常工作

global
    log stdout local0

defaults
    log global
    mode http
    timeout connect 5s
    timeout client  30s
    timeout server 30s
    option httplog
    option dontlognull

# 统计页面
listen stats
    bind *:8404
    mode http
    stats enable
    stats uri /
    stats refresh 10s

# HTTP 前端（无需 TLS）
frontend http_front
    mode http
    bind *:8081
    default_backend http_backend

# HTTP 后端（启用 PROXY protocol v2）
backend http_backend
    mode http
    # send-proxy-v2: 向后端发送 PROXY protocol v2，传递真实客户端 IP
    server http1 127.0.0.1:8080 send-proxy-v2
